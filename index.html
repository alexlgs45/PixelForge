<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Créateur de Mods Minecraft</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="home-page">
    <div class="hero">
        <h1>Crée et importe tes mods Minecraft facilement</h1>
        <p>
            Bienvenue sur le créateur de mods ultime pour Minecraft.
            Code en Python, importe depuis ta clé USB ou Internet,
            et personnalise ton expérience de jeu comme jamais !
        </p>
        <div class="cta-buttons">
            <a href="editor.html" class="btn">Coder un mod <i class="fas fa-code"></i></a>
            <a href="import.html" class="btn">Importer un mod <i class="fas fa-upload"></i></a>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Éditeur de Code - Mods Minecraft</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="editor-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
</head>
<body>
    <div class="sidebar">
        <button class="sidebar-btn active" onclick="loadPage('editor')">
            <i class="fas fa-code"></i> Code
        </button>
        <button class="sidebar-btn" onclick="window.location.href='import.html'">
            <i class="fas fa-upload"></i> Importer
        </button>
    </div>
    <div class="main-content">
        <h1>Éditeur de Code Python</h1>
        <div class="editor-container">
            <textarea id="codeEditor"></textarea>
        </div>
        <div class="editor-actions">
            <button id="saveCode" class="btn"><i class="fas fa-save"></i> Sauvegarder</button>
            <button id="downloadCode" class="btn"><i class="fas fa-download"></i> Télécharger</button>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="script.js"></script>
    <script src="editor-script.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Importer un Mod - Minecraft</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="import-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="sidebar">
        <button class="sidebar-btn" onclick="window.location.href='editor.html'">
            <i class="fas fa-code"></i> Code
        </button>
        <button class="sidebar-btn active" onclick="loadPage('import')">
            <i class="fas fa-upload"></i> Importer
        </button>
    </div>
    <div class="main-content">
        <h1>Importer un Mod</h1>
        <div class="import-container">
            <div class="upload-area" id="dropArea">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Glisse-dépose un fichier ici ou clique pour parcourir</p>
                <input type="file" id="fileInput" accept=".py,.jar,.zip">
            </div>
            <div id="filePreview" class="file-preview hidden">
                <h3>Fichier sélectionné : <span id="fileName"></span></h3>
                <p>Taille : <span id="fileSize"></span></p>
                <div id="fileContent" class="preview-content"></div>
                <button id="importBtn" class="btn"><i class="fas fa-check"></i> Valider l'importation</button>
            </div>
        </div>
    </div>
    <script src="script.js"></script>
    <script src="import-script.js"></script>
</body>
</html>
/* Styles communs */
:root {
    --primary: #6c5ce7;
    --secondary: #a29bfe;
    --dark: #2d3436;
    --light: #f5f6fa;
    --success: #00b894;
    --danger: #d63031;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, var(--dark), #636e72);
    color: var(--light);
    min-height: 100vh;
}

.sidebar {
    position: fixed;
    left: 0;
    top: 0;
    width: 250px;
    height: 100vh;
    background: #2d3436;
    padding: 20px 0;
    box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
    z-index: 100;
}

.sidebar-btn {
    display: block;
    width: 80%;
    margin: 10px auto;
    padding: 12px;
    background: transparent;
    color: var(--light);
    border: none;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s;
    text-align: left;
    padding-left: 20px;
}

.sidebar-btn i {
    margin-right: 10px;
}

.sidebar-btn:hover, .sidebar-btn.active {
    background: var(--primary);
    color: white;
}

.main-content {
    margin-left: 270px;
    padding: 20px;
}

.btn {
    padding: 10px 15px;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s;
    margin-right: 10px;
}

.btn:hover {
    background: #5649d1;
}

.btn i {
    margin-right: 5px;
}

/* Page d'accueil */
.home-page {
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 0 20px;
}

.hero {
    max-width: 800px;
}

.hero h1 {
    font-size: 2.5em;
    margin-bottom: 20px;
}

.hero p {
    font-size: 1.2em;
    margin-bottom: 30px;
    line-height: 1.6;
}

.cta-buttons {
    display: flex;
    justify-content: center;
    gap: 20px;
}

.cta-buttons .btn {
    padding: 12px 25px;
    font-size: 16px;
}

/* Responsive */
@media (max-width: 768px) {
    .sidebar {
        width: 100%;
        height: auto;
        position: relative;
        display: flex;
        justify-content: center;
        padding: 10px;
    }

    .sidebar-btn {
        width: 45%;
        margin: 0 5px;
    }

    .main-content {
        margin-left: 0;
        margin-top: 20px;
    }
}
.editor-container {
    background: #282a36;
    border-radius: 5px;
    padding: 10px;
    margin: 20px 0;
    height: 60vh;
    overflow: hidden;
}

.CodeMirror {
    height: 100%;
    font-size: 14px;
    line-height: 1.5;
}

.editor-actions {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}
.import-container {
    background: #282a36;
    border-radius: 5px;
    padding: 20px;
    margin: 20px 0;
}

.upload-area {
    border: 2px dashed var(--secondary);
    border-radius: 5px;
    padding: 40px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
}

.upload-area:hover {
    border-color: var(--primary);
}

.upload-area i {
    font-size: 50px;
    margin-bottom: 10px;
}

#fileInput {
    display: none;
}

.file-preview {
    margin-top: 20px;
    padding: 15px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 5px;
}

.preview-content {
    max-height: 200px;
    overflow-y: auto;
    background: #1e1f29;
    padding: 10px;
    border-radius: 5px;
    margin: 10px 0;
}

.hidden {
    display: none;
}
// Navigation entre les pages
function loadPage(page) {
    const buttons = document.querySelectorAll('.sidebar-btn');
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
}

// Gestion du glissé-déposé pour l'importation
document.addEventListener('DOMContentLoaded', () => {
    const dropArea = document.getElementById('dropArea');
    const fileInput = document.getElementById('fileInput');

    if (dropArea) {
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
            dropArea.style.borderColor = '#6c5ce7';
        }

        function unhighlight() {
            dropArea.style.borderColor = '#a29bfe';
        }

        dropArea.addEventListener('drop', handleDrop, false);
        fileInput.addEventListener('change', handleFiles);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles({ target: { files } });
        }

        function handleFiles(e) {
            const files = e.target.files;
            displayFileInfo(files[0]);
        }
    }
});

function displayFileInfo(file) {
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const filePreview = document.getElementById('filePreview');
    const fileContent = document.getElementById('fileContent');

    fileName.textContent = file.name;
    fileSize.textContent = formatFileSize(file.size);
    filePreview.classList.remove('hidden');

    const reader = new FileReader();
    reader.onload = function(e) {
        fileContent.textContent = e.target.result.substring(0, 1000) + (e.target.result.length > 1000 ? '...' : '');
    };
    reader.readAsText(file);
}

function formatFileSize(bytes) {
    if (bytes < 1024) return bytes + ' octets';
    else if (bytes < 1048576) return (bytes / 1024).toFixed(2) + ' Ko';
    else return (bytes / 1048576).toFixed(2) + ' Mo';
}
document.addEventListener('DOMContentLoaded', () => {
    // Initialisation de l'éditeur CodeMirror
    const editor = CodeMirror.fromTextArea(document.getElementById('codeEditor'), {
        mode: 'python',
        theme: 'dracula',
        lineNumbers: true,
        autoIndent: true,
        indentUnit: 4,
        tabSize: 4,
    });

    // Sauvegarder le code
    document.getElementById('saveCode').addEventListener('click', () => {
        const code = editor.getValue();
        localStorage.setItem('minecraftModCode', code);
        alert('Code sauvegardé localement !');
    });

    // Télécharger le code
    document.getElementById('downloadCode').addEventListener('click', () => {
        const code = editor.getValue();
        const blob = new Blob([code], { type: 'text/x-python' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'mon_mod_minecraft.py';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    });

    // Charger le code sauvegardé
    const savedCode = localStorage.getItem('minecraftModCode');
    if (savedCode) {
        editor.setValue(savedCode);
    }
});
document.addEventListener('DOMContentLoaded', () => {
    const importBtn = document.getElementById('importBtn');
    if (importBtn) {
        importBtn.addEventListener('click', () => {
            alert('Fichier importé avec succès ! (Simulé)');
            // Ici, tu pourrais ajouter la logique pour traiter le fichier importé
        });
    }
});
const express = require('express');
const multer = require('multer');
const path = require('path');
const fs = require('fs');
const app = express();
const port = 3000;

// Configuration du stockage des fichiers uploadés
const storage = multer.diskStorage({
    destination: (req, file, cb) => {
        const uploadDir = 'uploads';
        if (!fs.existsSync(uploadDir)) {
            fs.mkdirSync(uploadDir);
        }
        cb(null, uploadDir);
    },
    filename: (req, file, cb) => {
        cb(null, Date.now() + path.extname(file.originalname));
    }
});

const upload = multer({ storage: storage });

// Servir les fichiers statiques
app.use(express.static('public'));

// Route pour l'upload de fichiers
app.post('/upload', upload.single('modFile'), (req, res) => {
    if (!req.file) {
        return res.status(400).send('Aucun fichier uploadé.');
    }
    res.json({
        message: 'Fichier uploadé avec succès !',
        file: req.file
    });
});

app.listen(port, () => {
    console.log(`Serveur démarré sur http://localhost:${port}`);
});
const express = require('express');
const multer = require('multer');
const path = require('path');
const fs = require('fs');
const AdmZip = require('adm-zip');
const yaml = require('js-yaml');
const app = express();
const port = 3000;

// Configuration du stockage
const storage = multer.diskStorage({
    destination: (req, file, cb) => {
        const uploadDir = 'uploads';
        if (!fs.existsSync(uploadDir)) fs.mkdirSync(uploadDir);
        cb(null, uploadDir);
    },
    filename: (req, file, cb) => {
        cb(null, Date.now() + path.extname(file.originalname));
    }
});
const upload = multer({ storage: storage });

// Servir les fichiers statiques
app.use(express.static('public'));

// Upload de fichier
app.post('/upload', upload.single('modFile'), (req, res) => {
    if (!req.file) return res.status(400).send('Aucun fichier uploadé.');
    res.json({ message: 'Fichier uploadé.', file: req.file });
});

// Validation du mod
app.post('/validate', upload.single('modFile'), (req, res) => {
    if (!req.file) return res.status(400).send('Aucun fichier à valider.');

    const filePath = req.file.path;
    const report = validateMod(filePath);
    res.json(report);
});

function validateMod(filePath) {
    const report = { valid: true, errors: [], warnings: [], metadata: {} };

    try {
        // 1. Vérifier l'extension
        if (path.extname(filePath) === '.jar') {
            validateJar(filePath, report);
        } else if (path.extname(filePath) === '.py') {
            validatePython(filePath, report);
        } else {
            report.valid = false;
            report.errors.push('Format de fichier non supporté. Utilisez .jar ou .py.');
        }
    } catch (error) {
        report.valid = false;
        report.errors.push(`Erreur lors de la validation : ${error.message}`);
    }

    return report;
}

function validateJar(filePath, report) {
    const zip = new AdmZip(filePath);
    const zipEntries = zip.getEntries();

    // 2. Vérifier la présence de mods.toml (obligatoire pour Forge)
    const modsToml = zipEntries.find(entry => entry.entryName === 'META-INF/mods.toml');
    if (!modsToml) {
        report.valid = false;
        report.errors.push('Fichier mods.toml manquant dans le .jar (obligatoire pour Forge).');
        return;
    }

    // 3. Lire et parser mods.toml
    try {
        const content = zip.readAsText(modsToml);
        const modData = yaml.load(content);
        report.metadata = modData;

        // 4. Vérifier la version de Minecraft
        if (!modData.mods || !modData.mods[0]) {
            report.errors.push('Aucun mod défini dans mods.toml.');
            report.valid = false;
            return;
        }

        const mod = modData.mods[0];
        if (!mod.version) {
            report.warnings.push('Version du mod non spécifiée.');
        }

        // 5. Vérifier la compatibilité avec Forge 1.21.10
        if (modData.dependencies) {
            const forgeDep = modData.dependencies.find(dep => dep.modId === 'forge');
            if (forgeDep && !forgeDep.version.includes('1.21.10')) {
                report.errors.push(`Ce mod nécessite Forge ${forgeDep.version}, mais ce site supporte uniquement 1.21.10.`);
                report.valid = false;
            }
        }
    } catch (error) {
        report.errors.push(`Erreur de lecture de mods.toml : ${error.message}`);
        report.valid = false;
    }
}

function validatePython(filePath, report) {
    // 1. Lire le fichier Python
    const code = fs.readFileSync(filePath, 'utf8');

    // 2. Vérifier la présence de décorateurs/classes typiques de Forge
    if (!code.includes('@Mod(') && !code.includes('class ') && !code.includes('ModInitializer')) {
        report.warnings.push('Ce fichier Python ne semble pas être un mod Minecraft valide (manque @Mod ou ModInitializer).');
    }

    // 3. Vérifier la version de Minecraft (simulé)
    if (!code.includes('1.21.10') && !code.includes('1.21')) {
        report.warnings.push('Aucune référence à Minecraft 1.21.10 trouvée. Vérifiez la compatibilité.');
    }
}

app.listen(port, () => {
    console.log(`Serveur démarré sur http://localhost:${port}`);
});
document.addEventListener('DOMContentLoaded', () => {
    const dropArea = document.getElementById('dropArea');
    const fileInput = document.getElementById('fileInput');
    const importBtn = document.getElementById('importBtn');
    const validationReport = document.getElementById('validationReport');

    // Gestion du glissé-déposé et de la sélection de fichier
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
        dropArea.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, unhighlight, false);
    });

    function highlight() {
        dropArea.style.borderColor = '#6c5ce7';
    }

    function unhighlight() {
        dropArea.style.borderColor = '#a29bfe';
    }

    dropArea.addEventListener('drop', handleDrop, false);
    fileInput.addEventListener('change', handleFiles);

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        handleFiles({ target: { files } });
    }

    function handleFiles(e) {
        const files = e.target.files;
        displayFileInfo(files[0]);
    }

    function displayFileInfo(file) {
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const filePreview = document.getElementById('filePreview');

        fileName.textContent = file.name;
        fileSize.textContent = formatFileSize(file.size);
        filePreview.classList.remove('hidden');

        // Lire et afficher un aperçu (pour les fichiers texte)
        if (file.type.startsWith('text/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('fileContent').textContent = e.target.result.substring(0, 1000) + (e.target.result.length > 1000 ? '...' : '');
            };
            reader.readAsText(file);
        }
    }

    // Validation du mod
    importBtn.addEventListener('click', async () => {
        const fileInput = document.getElementById('fileInput');
        if (!fileInput.files.length) {
            alert('Veuillez sélectionner un fichier.');
            return;
        }

        const formData = new FormData();
        formData.append('modFile', fileInput.files[0]);

        try {
            const response = await fetch('http://localhost:3000/validate', {
                method: 'POST',
                body: formData
            });

            const report = await response.json();
            displayValidationReport(report);
        } catch (error) {
            console.error('Erreur:', error);
            validationReport.innerHTML = `<div class="error">Erreur lors de la validation : ${error.message}</div>`;
        }
    });

    function displayValidationReport(report) {
        let html = `<h3>Rapport de validation</h3>`;
        html += `<p>Statut : <strong>${report.valid ? '✅ Valide' : '❌ Invalide'}</strong></p>`;

        if (report.errors.length > 0) {
            html += `<div class="error-section"><h4>Erreurs :</h4><ul>`;
            report.errors.forEach(error => {
                html += `<li>${error}</li>`;
            });
            html += `</ul></div>`;
        }

        if (report.warnings.length > 0) {
            html += `<div class="warning-section"><h4>Avertissements :</h4><ul>`;
            report.warnings.forEach(warning => {
                html += `<li>${warning}</li>`;
            });
            html += `</ul></div>`;
        }

        if (report.metadata.mods) {
            html += `<div class="metadata-section"><h4>Métadonnées :</h4><pre>${JSON.stringify(report.metadata, null, 2)}</pre></div>`;
        }

        validationReport.innerHTML = html;
    }

    function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + ' octets';
        else if (bytes < 1048576) return (bytes / 1024).toFixed(2) + ' Ko';
        else return (bytes / 1048576).toFixed(2) + ' Mo';
    }
});
<!-- Dans import.html, ajoutez ceci dans le main-content, après filePreview -->
<div id="validationReport" class="validation-report hidden"></div>
.validation-report {
    margin-top: 20px;
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 5px;
}

.error-section {
    color: #d63031;
    background: rgba(214, 48, 49, 0.1);
    padding: 10px;
    border-radius: 5px;
    margin: 10px 0;
}

.warning-section {
    color: #fdcb6e;
    background: rgba(253, 203, 110, 0.1);
    padding: 10px;
    border-radius: 5px;
    margin: 10px 0;
}

.metadata-section {
    background: rgba(0, 0, 0, 0.2);
    padding: 10px;
    border-radius: 5px;
    margin: 10px 0;
}

.metadata-section pre {
    background: #1e1f29;
    padding: 10px;
    border-radius: 5px;
    overflow-x: auto;
}
const express = require('express');
const multer = require('multer');
const path = require('path');
const fs = require('fs');
const ejs = require('ejs');
const { exec } = require('child_process');
const app = express();
const port = 3000;

// Middleware
app.use(express.json());
app.use(express.static('public'));

// Route pour compiler du Python en .jar
app.post('/compile', async (req, res) => {
    const { code } = req.body;
    if (!code) return res.status(400).send('Aucun code fourni.');

    try {
        // 1. Générer le code Java à partir du template
        const javaCode = await generateJavaFromPython(code);

        // 2. Écrire les fichiers nécessaires pour Forge
        setupForgeProject(javaCode);

        // 3. Compiler avec Docker/Gradle
        const jarPath = await compileWithGradle();

        // 4. Lire le .jar et l'envoyer
        const jarBuffer = fs.readFileSync(jarPath);
        res.set('Content-Type', 'application/java-archive');
        res.send(jarBuffer);
    } catch (error) {
        console.error(error);
        res.status(500).send(`Erreur de compilation : ${error.message}`);
    }
});

// Génère du Java à partir du Python (simplifié)
async function generateJavaFromPython(pythonCode) {
    // Template EJS pour un mod Forge basique
    const template = `
    package com.monmod;

    import net.minecraftforge.fml.common.Mod;
    import net.minecraftforge.fml.event.lifecycle.FMLCommonSetupEvent;
    import net.minecraftforge.fml.javafmlmod.FMLJavaModLoadingContext;
    import org.apache.logging.log4j.LogManager;
    import org.apache.logging.log4j.Logger;

    @Mod("monmod")
    public class MonMod {
        private static final Logger LOGGER = LogManager.getLogger();

        public MonMod() {
            FMLJavaModLoadingContext.get().getModEventBus().addListener(this::setup);
        }

        private void setup(final FMLCommonSetupEvent event) {
            LOGGER.info("Mon mod est chargé !");
            //=== CODE PYTHON TRANSFORME ===//
            <% if (code.includes('on_block_break')) { %>
            // Exemple : Gestion de la casse de bloc
            event.enqueueWork(() -> {
                LOGGER.info("Fonction on_block_break activée !");
                // Ici, tu ajouterais la logique pour gérer la casse de bloc
            });
            <% } %>
            //=== FIN CODE PYTHON ===//
        }
    }
    `;

    return ejs.render(template, { code: pythonCode });
}

// Prépare la structure du projet Forge
function setupForgeProject(javaCode) {
    const projectDir = 'temp_forge_project';
    if (!fs.existsSync(projectDir)) fs.mkdirSync(projectDir);

    // Écrire le code Java
    const javaDir = path.join(projectDir, 'src/main/java/com/monmod');
    if (!fs.existsSync(javaDir)) fs.mkdirSync(javaDir, { recursive: true });
    fs.writeFileSync(path.join(javaDir, 'MonMod.java'), javaCode);

    // Écrire build.gradle pour Forge 1.21.10
    const gradleContent = `
    plugins {
        id 'java'
        id 'net.minecraftforge.gradle' version '6.0.+'
    }
    version = '1.0'
    group = 'com.monmod'
    archivesBaseName = 'monmod'

    repositories {
        maven { url 'https://maven.minecraftforge.net' }
        mavenCentral()
    }

    dependencies {
        implementation fg.deobf("net.minecraftforge:forge:1.21.10-47.1.0")
    }

    java {
        toolchain.languageVersion = JavaLanguageVersion.of(17)
    }
    `;
    fs.writeFileSync(path.join(projectDir, 'build.gradle'), gradleContent);
}

// Compile avec Docker/Gradle
function compileWithGradle() {
    return new Promise((resolve, reject) => {
        exec('docker run --rm -v "$(pwd)/temp_forge_project":/app -w /app openjdk:17-jdk-slim sh -c "chmod +x gradlew && ./gradlew build"',
            (error, stdout, stderr) => {
                if (error) {
                    reject(new Error(`Erreur de compilation: ${stderr}`));
                    return;
                }
                const jarPath = path.join('temp_forge_project', 'build', 'libs', 'monmod-1.0.jar');
                if (!fs.existsSync(jarPath)) {
                    reject(new Error('Aucun .jar généré. Vérifie les logs de compilation.'));
                    return;
                }
                resolve(jarPath);
            });
    });
}

app.listen(port, () => {
    console.log(`Serveur démarré sur http://localhost:${port}`);
});
// Dans editor-script.js, ajoute ceci à la fin :
document.getElementById('compileToJar').addEventListener('click', async () => {
    const code = editor.getValue();
    if (!code.trim()) {
        alert("Veuillez écrire du code avant de compiler.");
        return;
    }

    document.getElementById('status').textContent = "Compilation en cours...";

    try {
        const response = await fetch('http://localhost:3000/compile', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ code }),
        });

        if (!response.ok) {
            throw new Error(`Erreur HTTP: ${response.status}`);
        }

        const blob = await response.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'mon_mod_1.21.10.jar';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        document.getElementById('status').textContent = "Mod compilé et téléchargé !";
    } catch (error) {
        document.getElementById('status').textContent = `Erreur: ${error.message}`;
    }
});
// 1. Imports et configuration commune
const express = require('express');
const multer = require('multer');
const path = require('path');
const fs = require('fs');
const app = express();
const port = 3000;

// 2. Middleware (commun aux deux backends)
app.use(express.json());
app.use(express.static('public'));

// 3. Configuration de Multer (pour l'upload)
const storage = multer.diskStorage({ ... });
const upload = multer({ storage: storage });

// 4. Routes de l'ancien backend (upload/validation)
app.post('/upload', upload.single('modFile'), (req, res) => { ... });
app.post('/validate', upload.single('modFile'), (req, res) => { ... });

// 5. Routes du nouveau backend (compilation Python→Java)
app.post('/compile', express.json(), async (req, res) => { ... });

// 6. Fonctions utilitaires (pour la compilation)
async function generateJavaFromPython(pythonCode) { ... }
function setupForgeProject(javaCode) { ... }
function compileWithGradle() { ... }

// 7. Démarrage du serveur
app.listen(port, () => {
    console.log(`Serveur démarré sur http://localhost:${port}`);
});
<div class="sidebar">
    <button class="sidebar-btn" onclick="loadPage('editor')">
        <i class="fas fa-code"></i> Code
    </button>
    <button class="sidebar-btn" onclick="loadPage('import')">
        <i class="fas fa-upload"></i> Importer
    </button>
    <!-- NOUVEAU BOUTON -->
    <button class="sidebar-btn" id="openPythonEditorBtn">
        <i class="fas fa-file-code"></i> Éditeur Python
    </button>
</div>
<!-- Conteneur pour l'éditeur Python (masqué par défaut) -->
<div id="pythonEditorContainer" class="python-editor-container hidden">
    <div class="python-editor-header">
        <h2>Éditeur Python <span class="close-editor" onclick="closePythonEditor()">&times;</span></h2>
    </div>
    <div class="python-editor-body">
        <textarea id="pythonEditor"></textarea>
    </div>
    <div class="python-editor-actions">
        <button id="savePythonCode" class="btn"><i class="fas fa-save"></i> Sauvegarder</button>
        <button id="compilePythonCode" class="btn"><i class="fas fa-cogs"></i> Compiler en .jar</button>
        <button id="closePythonEditor" class="btn"><i class="fas fa-times"></i> Fermer</button>
    </div>
</div>
/* Éditeur Python flottant */
.python-editor-container {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80%;
    max-width: 800px;
    background: #282a36;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
    z-index: 1000;
    display: none; /* Masqué par défaut */
}

.python-editor-container.hidden {
    display: none;
}

.python-editor-header {
    padding: 15px;
    border-bottom: 1px solid #444;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.python-editor-header h2 {
    margin: 0;
    font-size: 1.5em;
}

.close-editor {
    cursor: pointer;
    font-size: 1.5em;
}

.python-editor-body {
    padding: 15px;
    height: 400px;
}

.python-editor-body #pythonEditor {
    width: 100%;
    height: 100%;
    background: #1e1f29;
    border: none;
    border-radius: 5px;
    padding: 10px;
    font-family: monospace;
    color: #f8f8f2;
    font-size: 14px;
}

.python-editor-actions {
    padding: 15px;
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    border-top: 1px solid #444;
}
// Fonction pour ouvrir l'éditeur Python
function openPythonEditor() {
    const container = document.getElementById('pythonEditorContainer');
    container.classList.remove('hidden');

    // Initialiser CodeMirror si ce n'est pas déjà fait
    if (!window.pythonEditor) {
        window.pythonEditor = CodeMirror.fromTextArea(
            document.getElementById('pythonEditor'), {
                mode: 'python',
                theme: 'dracula',
                lineNumbers: true,
                autoIndent: true,
                indentUnit: 4,
                tabSize: 4,
            }
        );
    }

    // Charger le code sauvegardé (si disponible)
    const savedCode = localStorage.getItem('pythonModCode');
    if (savedCode) {
        window.pythonEditor.setValue(savedCode);
    }
}

// Fonction pour fermer l'éditeur Python
function closePythonEditor() {
    document.getElementById('pythonEditorContainer').classList.add('hidden');
}

// Écouteur d'événement pour le bouton d'ouverture
document.addEventListener('DOMContentLoaded', () => {
    const openBtn = document.getElementById('openPythonEditorBtn');
    if (openBtn) {
        openBtn.addEventListener('click', openPythonEditor);
    }

    const closeBtn = document.getElementById('closePythonEditor');
    if (closeBtn) {
        closeBtn.addEventListener('click', closePythonEditor);
    }

    // Sauvegarder le code Python
    const savePythonBtn = document.getElementById('savePythonCode');
    if (savePythonBtn) {
        savePythonBtn.addEventListener('click', () => {
            const code = window.pythonEditor.getValue();
            localStorage.setItem('pythonModCode', code);
            alert('Code Python sauvegardé !');
        });
    }

    // Compiler le code Python (à lier au backend plus tard)
    const compilePythonBtn = document.getElementById('compilePythonCode');
    if (compilePythonBtn) {
        compilePythonBtn.addEventListener('click', async () => {
            const code = window.pythonEditor.getValue();
            if (!code.trim()) {
                alert("Veuillez écrire du code avant de compiler.");
                return;
            }

            document.getElementById('status').textContent = "Compilation en cours...";

            try {
                const response = await fetch('http://localhost:3000/compile', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code }),
                });

                if (!response.ok) throw new Error(`Erreur HTTP: ${response.status}`);

                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'mon_mod_1.21.10.jar';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                alert("Mod compilé et téléchargé avec succès !");
            } catch (error) {
                alert(`Erreur: ${error.message}`);
            }
        });
    }
});
